<!-- Make HTTP Requests with React -->
<body>
	<div id="root"></div>
	<script src="https://unpkg.com/react@18.3.1/umd/react.development.js"></script>
	<script src="https://unpkg.com/react-dom@18.3.1/umd/react-dom.development.js"></script>
	<script src="https://unpkg.com/@babel/standalone@7.28.4/babel.js"></script>
	<script type="text/babel">
		function PokemonInfo({ pokemonName }) {
			const [status, setStatus] = React.useState('idle');
			const [pokemon, setPokemon] = React.useState(null);
			const [error, setError] = React.useState(null);

			React.useEffect(() => {
				if (!pokemonName) return;
				setStatus('pending');
				fetchPokemon(pokemonName).then(
					(pokemonData) => {
						setStatus('resolved');
						setPokemon(pokemonData);
					},
					(errorData) => {
						setStatus('rejected');
						setError(errorData);
					}
				);
			}, [pokemonName]);
			if (status === 'idle') return 'Submit a pokemon';
			if (status === 'rejected') return 'Something went wrong...' + error;
			if (status === 'pending') {
				return '...';
			}
			if (status === 'resolved') {
				return <pre>{JSON.stringify(pokemon, null, 2)}</pre>;
			}
		}

		function App() {
			const [pokemonName, setPokemonName] = React.useState('');

			function handleSubmit(event) {
				event.preventDefault();
				setPokemonName(event.target.elements.pokemonName.value);
			}
			return (
				<div>
					<form onSubmit={handleSubmit}>
						<label htmlFor='pokemonName'>Pokemon Name</label>
						<div>
							<input id='pokemonName' />
							<button type='submit'>Submit</button>
						</div>
					</form>
					<hr />
					<PokemonInfo pokemonName={pokemonName} />
				</div>
			);
		}

		function fetchPokemon(name) {
			const pokemonQuery = `
                query ($name: String) {
                pokemon(name: $name) {
                    id
                    name
                    types
                    evolutions {
                        id
                        name
                        types
                    }
                }
                }
            `;

			return window
				.fetch('https://graphql-pokemon2.vercel.app', {
					// learn more about this API here: https://graphql-pokemon.now.sh/
					method: 'POST',
					headers: {
						'content-type': 'application/json;charset=UTF-8',
					},
					body: JSON.stringify({
						query: pokemonQuery,
						variables: { name },
					}),
				})
				.then((r) => r.json())
				.then((response) => response.data.pokemon);
		}

		const root = ReactDOM.createRoot(document.getElementById('root'));
		root.render(<App />);
	</script>
</body>
